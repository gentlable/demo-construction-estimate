# 簡易見積もりツール 仕様書（PoC／モック段階）

---

## 1. 目的・スコープ

- **目的**：親会社（元請）からの問い合わせに対し、人夫（作業員）数量と概算金額を即算出する。
- **対象範囲**：ブラウザ上で動作するシングル HTML ファイル＋JavaScript のみで構成する PoC。マスターデータは静的な `.json` ファイル（または HTML 内埋込 JSON）として保持し、サーバレスで動作させる。

## 2. プラットフォーム & 技術スタック

| 項目    | 内容                                  |
| ----- | ----------------------------------- |
| 実行環境  | 最新版 Google Chrome (Windows / macOS) |
| 技術    | HTML5, Vanilla JavaScript (ES6 以降)  |
| データ保存 | 静的 JSON（読み取り専用）                     |
| ライブラリ | なし（依存ゼロ）                            |

## 3. マスターデータ設計

### 3.1 JSON 形式

> **以下の JSON はあくまで参考例です。実際の案件では、工事種別や作業内容により必要パラメータや計算式・単価が大きく異なります。本ツールではマスタ JSON を自由に編集することで、任意の項目追加・ロジック変更に対応できます。**

```json
{
  "工事種別": {
    "RC解体": {
      "はつり": {
        "params": {
          "area": { "label": "面積", "unit": "m²" },
          "depth": { "label": "深さ", "unit": "cm" }
        },
        "unitPrice": 18000,
        "formula": "(area * depth / 100) * 0.12"  // 人工(人日)
      },
      "搬出": {
        "params": {
          "volume": { "label": "体積", "unit": "m³" },
          "floor":  { "label": "階数", "unit": "階" }
        },
        "unitPrice": 8500,
        "formula": "(volume * 0.1) + (floor * 0.25)"  // 人工(人日)
      }
    }
  }
}
```

| プロパティ       | 説明                                                                                          |
| ----------- | ------------------------------------------------------------------------------------------- |
| `params`    | **必須**。作業ごとに必要な入力項目をキーで列挙。各キーは UI 生成時の名前空間にもなる。                                             |
| `label`     | 項目の表示名（日本語）                                                                                 |
| `unit`      | 単位表示（″m²″、″本″ など）                                                                           |
| `unitPrice` | 1 単位あたりの概算請負単価（円）。金額計算に使用。                                                                  |
| `formula`   | **必須**。JavaScript で解釈可能な簡易式文字列。`params` のキー名を変数として参照可。演算子は `+ - * / ( )` を許容し、式評価結果＝人工（人日）。 |

### 3.2 拡張方針

- **入力項目を増やすだけ**で UI 自動生成と計算に反映される。
- 安全性確保のため、`eval()` は使わず、自前の簡易パーサで変数置換＆四則演算のみ許容。

## 4. 機能要件

1. **工事種別選択**：`<select>` 要素にマスタのキー（例: RC解体）をバインド。
2. **作業選択**：チェックボックス複数選択。選択肢は工事種別に応じて動的生成。
3. **入力フィールド生成**：
   - チェックした作業ごとに、`params` で定義された項目数だけ `<input type="number">` を生成。
   - 単位ラベルを項目横に表示。
4. **自動計算**
   - 各作業の `formula` を評価し、人工（人日）を算出。
   - 金額 = **合算入力値 × **``（単一または複数パラメータの合算ロジックは必要に応じて式内で記述）。
   - 作業単位／総計（人工・金額）を即時再計算し表示。
5. **概算出力**：画面下部にテーブルとして表示（コピー・印刷用）。保存機能は持たせない。

## 5. 非機能要件（PoC想定）

| 区分      | 要件                                      |
| ------- | --------------------------------------- |
| 保守性     | マスタ JSON 修正のみで工事種別／作業追加・入力項目増減・計算式変更が可能 |
| 性能      | 入力項目数百まで即時再計算（目安 100 ms 未満）             |
| ユーザビリティ | デフォルト値・基本数値チェックのみ（詳細バリデーションは未実装）        |
| セキュリティ  | オフライン利用、外部通信なし                          |

